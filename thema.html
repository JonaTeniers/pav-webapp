<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAV-O | Thema</title>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&display=swap">

<style>
:root{
--bg:#f8fafc;
--panel:#ffffff;
--accent:#0f766e;
--accent-dark:#0b5f58;
--text:#1f2937;
--muted:#4b5563;
}

*{box-sizing:border-box;}

body{
margin:0;
font-family:'Nunito',sans-serif;
background:var(--bg);
color:var(--text);
}

header{
color:white;
padding:2rem 1rem;
text-align:center;
}

header h1{
margin:0;
font-size:2rem;
}

main{
width:min(1100px,95%);
margin:2rem auto;
display:grid;
grid-template-columns:2fr 1fr;
gap:1.5rem;
}

.panel{
background:var(--panel);
border-radius:14px;
padding:1.5rem;
box-shadow:0 6px 16px rgba(0,0,0,0.08);
}

.task{
margin-top:1.5rem;
border-top:1px solid #e5e7eb;
padding-top:1.2rem;
}

.units-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
gap:0.8rem;
margin-top:1rem;
}

.unit-card{
border:2px solid #bce7e1;
border-radius:12px;
padding:1rem;
background:#f0fdfa;
}

.unit-card h4{
margin:0 0 0.3rem;
}

.unit-card button{
width:100%;
border:none;
border-radius:8px;
padding:0.5rem;
font-weight:700;
color:white;
cursor:pointer;
}

.chat-embed{
width:100%;
min-height:500px;
border:none;
border-radius:12px;
background:#f3f7ff;
}

.btn{
display:inline-block;
margin-top:1rem;
text-decoration:none;
color:white;
padding:0.5rem 0.9rem;
border-radius:999px;
font-weight:700;
}

@media(max-width:900px){
main{grid-template-columns:1fr;}
}
</style>
</head>

<body>

<header id="themeHeader">
<h1 id="themeTitle">Laden...</h1>
<p id="themeDesc"></p>
</header>

<main>

<section class="panel">

<h2>Focus van dit thema</h2>
<p id="focusText"></p>

<div id="dynamicContent" class="task"></div>

<div class="task">
<h3>üìö Units</h3>
<div id="unitsContainer" class="units-grid"></div>
</div>

<a href="index.html" class="btn" id="backBtn">‚Üê Terug naar overzicht</a>

</section>

<aside class="panel">
<h2>ü§ñ Chattie</h2>
<p style="color:var(--muted);">Chat assistent voor dit thema.</p>
<iframe class="chat-embed" id="chatFrame"></iframe>
</aside>

</main>

<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
<script src="./firebase.js"></script>

<script>

async function loadTheme(){

await window.firebaseReady;

const params = new URLSearchParams(window.location.search);
const themeId = params.get("id");

if(!themeId){
document.body.innerHTML="Geen thema ID.";
return;
}

const doc = await window.db.collection("themes").doc(themeId).get();

if(!doc.exists){
document.body.innerHTML="Thema niet gevonden.";
return;
}

const theme = doc.data();

/* HEADER */
document.getElementById("themeTitle").innerText = theme.title;
document.getElementById("themeDesc").innerText = theme.description;
document.getElementById("focusText").innerText = theme.description;

document.getElementById("themeHeader").style.background = theme.color;
document.getElementById("backBtn").style.background = theme.color;

/* UNITS */
const unitsContainer = document.getElementById("unitsContainer");
unitsContainer.innerHTML="";

if(theme.units && theme.units.length){

theme.units.forEach((unit,i)=>{

unitsContainer.innerHTML += `
<div class="unit-card">
<h4>Unit ${i+1}</h4>
<p>${unit}</p>
<button style="background:${theme.color}">
Start
</button>
</div>
`;

});

}else{
unitsContainer.innerHTML="<p>Nog geen units toegevoegd.</p>";
}

/* DYNAMISCHE CONTENT */

const dynamic = document.getElementById("dynamicContent");
dynamic.innerHTML="";

if(theme.contentType==="sources" && theme.sources){

dynamic.innerHTML+="<h3>Bronnen</h3>";

theme.sources.forEach(source=>{
dynamic.innerHTML+=`
<div style="margin-top:0.8rem;">
<strong>${source.title}</strong><br>
<a href="${source.url}" target="_blank" style="color:${theme.color};font-weight:700;text-decoration:none;">
Bekijk artikel
</a>
</div>
`;
});

}

else if(theme.contentType==="image" && theme.imageUrl){

dynamic.innerHTML=`
<h3>Afbeelding</h3>
<img src="${theme.imageUrl}" style="width:100%;border-radius:12px;margin-top:1rem;">
`;

}

else if(theme.contentType==="text" && theme.extraText){

dynamic.innerHTML=`
<h3>Extra informatie</h3>
<p>${theme.extraText}</p>
`;

}

/* CHATTIE */
document.getElementById("chatFrame").src =
`chattie.html?thema=${encodeURIComponent(theme.title)}`;

}

loadTheme();

</script>

</body>
</html>
