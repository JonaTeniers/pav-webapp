<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PAVO Thema</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&display=swap">

<style>
:root {
  --bg:#f8fafc;
  --panel:#ffffff;
  --accent:#0f766e;
  --accent-dark:#0b5f58;
  --text:#1f2937;
  --muted:#4b5563;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Nunito',sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  background:#14b8a6;
  color:white;
  padding:1.8rem 1rem;
  text-align:center;
}
main{
  width:min(1100px,95%);
  margin:1.5rem auto 2rem;
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:1rem;
}
.panel{
  background:var(--panel);
  border-radius:14px;
  padding:1.2rem;
  box-shadow:0 6px 16px rgba(0,0,0,0.08);
}
.task{
  margin-top:1rem;
  border-top:1px solid #dbe5ef;
  padding-top:1rem;
}
.unit-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
  gap:0.8rem;
  margin-top:0.8rem;
}
.unit-card{
  border:2px solid #bce7e1;
  border-radius:12px;
  padding:0.9rem;
  background:#f0fdfa;
}
.unit-card h4{margin:0 0 .35rem}
.unit-card p{
  margin:0 0 .65rem;
  color:var(--muted);
  font-size:.95rem;
}
.unit-card .status{
  font-size:.82rem;
  font-weight:700;
  color:#0b5f58;
  margin-bottom:.7rem;
}
.unit-card button{
  width:100%;
  border:none;
  border-radius:8px;
  padding:.5rem .7rem;
  font-weight:700;
  color:#fff;
  background:var(--accent);
  cursor:pointer;
}
.unit-card button:disabled{
  background:#cbd5e1;
  cursor:not-allowed;
}
.chat-embed{
  width:100%;
  min-height:520px;
  border:none;
  border-radius:12px;
}
.btn{
  display:inline-block;
  margin-top:.8rem;
  background:var(--accent);
  color:white;
  padding:.5rem .9rem;
  border-radius:999px;
  font-weight:700;
  text-decoration:none;
}
@media(max-width:900px){
  main{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header>
  <h1 id="themeTitle">Laden...</h1>
  <p id="themeSubtitle"></p>
</header>

<main>
  <section class="panel">

    <h2>Focus van dit thema</h2>
    <p id="themeFocus"></p>

    <div class="task">
      <h3>Wat oefen je?</h3>
      <ul id="themeSkills"></ul>
    </div>

    <div class="task">
      <h3> Units</h3>
      <div class="unit-grid" id="unitsContainer"></div>
    </div>

    <a class="btn" href="index.html">‚Üê Terug naar overzicht</a>

  </section>

  <aside class="panel">
    <h2>Chattie</h2>
    <iframe id="chattieFrame" class="chat-embed"></iframe>
  </aside>

</main>

<script src="./firebase.js"></script>

<script>
async function loadTheme(){

  await window.firebaseReady;

  const params = new URLSearchParams(window.location.search);
  const themeId = params.get("id");

  if(!themeId){
    document.getElementById("themeTitle").innerText = "Thema niet gevonden";
    return;
  }

  const doc = await window.db.collection("themes").doc(themeId).get();

  if(!doc.exists){
    document.getElementById("themeTitle").innerText = "Thema bestaat niet";
    return;
  }

  const data = doc.data();

  // Header
  document.getElementById("themeTitle").innerText = data.title || "Thema";
  document.getElementById("themeSubtitle").innerText = data.description || "";

  // Focus
  document.getElementById("themeFocus").innerText = data.focus || "";

  // Skills
  const skillsList = document.getElementById("themeSkills");
  skillsList.innerHTML = "";
  if(data.skills){
    data.skills.forEach(skill=>{
      skillsList.innerHTML += `<li>${skill}</li>`;
    });
  }

  // Units
  const unitsContainer = document.getElementById("unitsContainer");
  unitsContainer.innerHTML = "";

  if(data.units && data.units.length > 0){

    data.units.forEach((unit,index)=>{

      const card = document.createElement("div");
      card.className = "unit-card";

      card.innerHTML = `
        <h4>Unit ${index+1}</h4>
        <p>${unit.title || ""}</p>
        <p class="status">${unit.active ? "Beschikbaar" : "In ontwikkeling"}</p>
        ${
          unit.active
          ? `<button onclick="openUnit('${themeId}',${index})">Start</button>`
          : `<button disabled>Binnenkort</button>`
        }
      `;

      unitsContainer.appendChild(card);
    });

  } else {

    unitsContainer.innerHTML = `
      <div class="unit-card">
        <h4>In ontwikkeling</h4>
        <img src="img/images/pavobouwmascotte.png" style="width:100%;border-radius:10px;margin-top:10px;">
      </div>
    `;
  }

  // Chattie koppelen
  document.getElementById("chattieFrame").src =
    "chattie.html?thema=" + encodeURIComponent(data.title);

}

function openUnit(themeId,index){
  window.location.href = "unit.html?theme="+themeId+"&unit="+index;
}

loadTheme();
</script>

</body>
</html>
