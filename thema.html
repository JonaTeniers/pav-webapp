<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PAVO Thema</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&display=swap">

<style>
:root {
  --bg:#f8fafc;
  --panel:#ffffff;
  --accent:#0f766e;
  --accent-dark:#0b5f58;
  --text:#1f2937;
  --muted:#4b5563;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Nunito',sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  background:#14b8a6;
  color:white;
  padding:1.8rem 1rem;
  text-align:center;
}
main{
  width:min(1100px,95%);
  margin:1.5rem auto 2rem;
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:1rem;
}
.panel{
  background:var(--panel);
  border-radius:14px;
  padding:1.2rem;
  box-shadow:0 6px 16px rgba(0,0,0,0.08);
}
.task{
  margin-top:1rem;
  border-top:1px solid #dbe5ef;
  padding-top:1rem;
}
.unit-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(190px,1fr));
  gap:0.8rem;
  margin-top:0.8rem;
}
.unit-card{
  border:2px solid #bce7e1;
  border-radius:12px;
  padding:0.9rem;
  background:#f0fdfa;
}
.unit-card h4{margin:0 0 .35rem}
.unit-card p{
  margin:0 0 .65rem;
  color:var(--muted);
  font-size:.95rem;
}
.unit-card .status{
  font-size:.82rem;
  font-weight:700;
  color:#0b5f58;
  margin-bottom:.7rem;
}
.unit-card button{
  width:100%;
  border:none;
  border-radius:8px;
  padding:.5rem .7rem;
  font-weight:700;
  color:#fff;
  background:var(--accent);
  cursor:pointer;
}
.unit-card button:disabled{
  background:#cbd5e1;
  cursor:not-allowed;
}
.link-card{
  border:1px solid #cce7e3;
  border-radius:10px;
  padding:0.8rem;
  background:#f0fdfa;
  margin-bottom:0.6rem;
}
.link-card a{
  color:#0f766e;
  font-weight:700;
  text-decoration:none;
}
.link-card a:hover{
  text-decoration:underline;
}
.media-img{
  width:100%;
  border-radius:12px;
  margin-top:0.8rem;
}
.media-video{
  width:100%;
  height:400px;
  border:none;
  border-radius:12px;
  margin-top:0.8rem;
}
.chat-embed{
  width:100%;
  min-height:520px;
  border:none;
  border-radius:12px;
}
.btn{
  display:inline-block;
  margin-top:.8rem;
  background:var(--accent);
  color:white;
  padding:.5rem .9rem;
  border-radius:999px;
  font-weight:700;
  text-decoration:none;
}
@media(max-width:900px){
  main{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header>
  <h1 id="themeTitle">Laden...</h1>
  <p id="themeSubtitle"></p>
</header>

<main>
  <section class="panel">

    <!-- Dynamische bovenruimte -->
    <div id="topBlocksContainer"></div>

    <!-- Units -->
    <div class="task">
      <h3>Units</h3>
      <div class="unit-grid" id="unitsContainer"></div>
    </div>

    <a class="btn" href="index.html">‚Üê Terug naar overzicht</a>

  </section>

  <aside class="panel">
    <h2>Chattie</h2>
    <iframe id="chattieFrame" class="chat-embed"></iframe>
  </aside>

</main>

<script src="./firebase.js"></script>

<script>
async function loadTheme(){

  await window.firebaseReady;

  const params = new URLSearchParams(window.location.search);
  const themeId = params.get("id");

  if(!themeId){
    document.getElementById("themeTitle").innerText = "Thema niet gevonden";
    return;
  }

  const doc = await window.db.collection("themes").doc(themeId).get();

  if(!doc.exists){
    document.getElementById("themeTitle").innerText = "Thema bestaat niet";
    return;
  }

  const data = doc.data();

  document.getElementById("themeTitle").innerText = data.title || "Thema";
  document.getElementById("themeSubtitle").innerText = data.description || "";

  renderTopBlocks(data.topBlocks || {});
  renderUnits(data.units || [], themeId);

  document.getElementById("chattieFrame").src =
    "chattie.html?thema=" + encodeURIComponent(data.title);
}

function renderTopBlocks(blocks){

  const container = document.getElementById("topBlocksContainer");
  container.innerHTML = "";

  // Focus
  if(blocks.focus?.enabled){
    container.innerHTML += `
      <h2>Focus van dit thema</h2>
      <p>${blocks.focus.text || ""}</p>
    `;
  }

  // Skills
  if(blocks.skills?.enabled && blocks.skills.items?.length){
    let skillsHTML = `<div class="task"><h3>Wat oefen je?</h3><ul>`;
    blocks.skills.items.forEach(skill=>{
      skillsHTML += `<li>${skill}</li>`;
    });
    skillsHTML += `</ul></div>`;
    container.innerHTML += skillsHTML;
  }

  // Links
  if(blocks.links?.enabled && blocks.links.items?.length){
    let linksHTML = `<div class="task"><h3>Handige links</h3>`;
    blocks.links.items.forEach(link=>{
      linksHTML += `
        <div class="link-card">
          <a href="${link.url}" target="_blank">${link.title}</a>
        </div>
      `;
    });
    linksHTML += `</div>`;
    container.innerHTML += linksHTML;
  }

  // Image
  if(blocks.image?.enabled && blocks.image.url){
    container.innerHTML += `
      <div class="task">
        <h3>Afbeelding</h3>
        <img src="${blocks.image.url}" class="media-img">
        <p>${blocks.image.caption || ""}</p>
      </div>
    `;
  }

  // Video
  if(blocks.video?.enabled && blocks.video.url){
    container.innerHTML += `
      <div class="task">
        <h3>Video</h3>
        <iframe class="media-video" src="${blocks.video.url}" allowfullscreen></iframe>
      </div>
    `;
  }

  // Extra info
  if(blocks.extra?.enabled && blocks.extra.text){
    container.innerHTML += `
      <div class="task">
        <h3>Extra info</h3>
        <p>${blocks.extra.text}</p>
      </div>
    `;
  }
}

function renderUnits(units, themeId){

  const container = document.getElementById("unitsContainer");
  container.innerHTML = "";

  if(units.length === 0){
    container.innerHTML = `
      <div class="unit-card">
        <h4>In ontwikkeling</h4>
        <img src="img/images/pavobouwmascotte.png" 
             style="width:100%;border-radius:10px;margin-top:10px;">
      </div>
    `;
    return;
  }

  units.forEach((unit,index)=>{

    const card = document.createElement("div");
    card.className = "unit-card";

    card.innerHTML = `
      <h4>Unit ${index+1}</h4>
      <p>${unit.title || ""}</p>
      <p class="status">${unit.active ? "Beschikbaar" : "In ontwikkeling"}</p>
      ${
        unit.active
        ? `<button onclick="openUnit('${themeId}',${index})">Start</button>`
        : `<button disabled>Binnenkort</button>`
      }
    `;

    container.appendChild(card);
  });
}

function openUnit(themeId,index){
  window.location.href = "unit.html?theme="+themeId+"&unit="+index;
}

loadTheme();
</script>

</body>
</html>
