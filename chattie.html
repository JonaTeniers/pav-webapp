<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chattie - AI-leerbuddy</title>
<style>
html, body { height: 100%; }
:root {
  --bg1: #CFE3D3;
  --bg2: #F9F8F4;
  --card: #ffffff;
  --bot: #eaf7ee;
  --user: #E7DCC8;
  --accent: #A9C2A6;
  --muted: #8B8C89;
  --chip-bg: #CBBBA0;
  --chip-text: #3a301a;
  --status-active-color: #4CAF50;
  --status-escalation-color: #b45309;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif;
  background: linear-gradient(120deg, var(--bg1), var(--bg2));
  color: #0f172a;
  display: flex;
  justify-content: center;
  height: 100%;
}

.container {
  width: 100%;
  height: 100%;
  background: var(--card);
  display: flex;
  overflow: hidden;
}

.chat {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  padding: 14px;
  gap: 12px;
}

#messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  border-radius: 12px;
  background: var(--bg2);
  border: 1px solid rgba(0,0,0,0.04);
}

.msg { display: flex; gap: 10px; margin: 10px 0; align-items: flex-end; }
.msg.bot { justify-content: flex-start; }
.msg.user { justify-content: flex-end; }
.bubble {
  max-width: 76%;
  padding: 12px 14px;
  border-radius: 14px;
  font-size: 15px;
  line-height: 1.35;
}
.bubble.bot { background: var(--bot); color: #05341a; border-radius: 14px 14px 14px 6px; }
.bubble.user { background: var(--user); color: #3a301a; border-radius: 14px 14px 6px 14px; text-align: right; }

.quick { display: flex; gap: 8px; flex-wrap: wrap; }

.chip-btn {
  background: var(--chip-bg);
  border-radius: 12px;
  padding: 8px 10px;
  border: 1px solid var(--muted);
  cursor: pointer;
  color: var(--chip-text);
  font-weight: 600;
  white-space: nowrap;
  font-size: 14px;
}

.input-row { display: flex; gap: 10px; }
.input-row input {
  flex: 1;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,0.06);
  font-size: 15px;
}
.send-btn {
  background: var(--accent);
  color: #fff;
  padding: 10px 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  font-weight: 700;
}

.muted { color: var(--muted); font-size: 13px; }

@media (max-width:880px){
  .container {
    height: 100vh;
  }
}
</style>
</head>

<body>
<div class="container">
  <div class="chat">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong id="chatTitle">ðŸ¤– Chattie</strong>
      <button id="howBtn" class="send-btn" style="padding:8px 12px;">Hoe werkt dit?</button>
    </div>

    <div id="messages" aria-live="polite"></div>

    <div class="quick" style="margin-top:10px; margin-bottom:12px;">
      <button class="chip-btn" data-action="more">Meer info</button>
      <button class="chip-btn" data-action="example">Voorbeeld</button>
      <button class="chip-btn" data-action="dontget">Ik snap het niet</button>
      <button class="chip-btn" data-action="assignment">Opdracht</button>
      <button class="chip-btn" data-action="stap">Volgende stap</button>
      <button class="chip-btn" data-action="samenvat">Samenvatting</button>
      <button class="chip-btn" data-action="kernwoorden">Kernwoorden</button>
    </div>

    <div class="input-row" style="margin-top:12px">
      <input id="userInput" placeholder='Typ "start" om te beginnen of stel een vraag' autocomplete="off" />
      <button id="sendButton" class="send-btn">Verstuur</button>
    </div>
  </div>
</div>

<script>
// -------------------------
// CONFIG & STATE
// -------------------------
const RESET_CODE = "resetchattie2025";
const ESCALATION_LIMIT = 3;
const TYPING_MS = 800;
const CUSTOM_STORAGE_KEY = "chattieCustomLeerstofV1";
const FORBIDDEN = ["fuck","kut","lul","trut","sukkel","idioot","kanker","rotzak","hoer","slet","eikel","klootzak","mongool","flikker","aso","wijf","tyfus","tering","pleuris","pest","debiel","achterlijk","mafkees","lapzwans","snol","del","kech","zak","schijt","gay","lesbo","mietje","poot","pot","nicht","faggot","fag","dyke","tranny","transseksueel","homofiel","kontneuker","biseksueel","motherfucker","cunt"];

const KNOWLEDGE = {
  "ai":"AI is technologie die machines in staat stelt te denken en leren zoals mensen.",
  "machine learning":"Machine learning is een tak van AI waarbij systemen leren van data.",
  "deep learning":"Een vorm van machine learning met neurale netwerken die complexe patronen herkennen.",
  "sociaal welzijn":"De mate waarin mensen zich goed voelen en kunnen deelnemen aan de samenleving.",
  "pedagogisch werk":"Het begeleiden en opvoeden van jongeren in hun ontwikkeling.",
  "ethiek":"Nadenken over wat goed of fout is in het handelen van mensen (en AI-systemen).",
  "ethiek in het onderwijs":"Het nadenken over morele keuzes binnen onderwijs en opvoeding.",
  "natuur":"Weinig of geen bebouwing, veel groen, bossen, velden en dieren.",
  "industrieel":"Omgeving met fabrieken, transport, opslag en weinig groen.",
  "landelijk":"Huizen staan verspreid, open ruimte, akkers en weilanden.",
  "stedelijk":"Huizen dicht bij elkaar, hoogbouw, druk verkeer, weinig natuur.",
  "toeristisch":"Omgeving met veel attracties, strand, bergen of musea voor bezoekers.",
  "cognitieve vermogens":"Mentale vaardigheden zoals denken, leren en begrijpen.",
  "autonoom":"Zelfstandig, zonder menselijke tussenkomst.",
  "ethisch dilemma":"Een situatie waarbij je moet kiezen tussen twee waarden of principes.",
  "privacy":"Het recht om persoonlijke informatie geheim te houden.",
  "deepfake":"Een door AI gemanipuleerde video of foto die echt lijkt, maar nep is.",
  "discriminatie door ai":"AI kan onbedoeld bevooroordeeld zijn, bijvoorbeeld bij sollicitaties.",
  "energieverbruik van ai":"Het trainen van AI kost veel energie en water.",
  "agi":"Artificial General Intelligence â€” een AI die net zo slim is als mensen.",
  "ava technologie":"Technologie die automatisch de beste thumbnail kiest voor een video.",
  "zelfrijdende auto":"Een voertuig dat zonder chauffeur rijdt door sensoren en AI.",
  "autonome shuttle":"Een klein zelfrijdend busje, zoals in Leuven, dat leert uit zijn omgeving.",

  // NIEUW TOEGEVOEGDE VZNS VAN HET ARTIKEL:
  "senaat lek": "HLN meldde een ernstig datalek bij de Senaat, waarbij gevoelige info zoals terreurprotocollen en gsm-nummers van politici op straat kwamen door het gelekte wachtwoord van een conciÃ«rge.",
  "infostealer": "Volgens HLN gaat het hier om 'infostealers', kwaadaardige software zoals Lumma Stealer, die ongemerkt alle ingevoerde gegevens stelen om ze door te verkopen aan criminelen.",
  "multifactorauthenticatie": "HLN benadrukt dat Multifactorauthenticatie (MFA) cruciaal is; dit voegt een extra beveiligingsstap toe, wat het Senaat-lek had kunnen voorkomen.",
  "wachtwoord hygiÃ«ne": "Uit het HLN-artikel blijkt hoe belangrijk goede WachtwoordhygiÃ«ne is: gebruik unieke, lange wachtwoorden voor elke dienst om te voorkomen dat Ã©Ã©n lek alles compromitteert.",
  "datingfraude AI": "VRT NWS onthulde hoe malafide datingsites AI gebruiken om kwetsbare singles financieel op te lichten met **deels AI-gegenereerde berichten** en een duur betaalmodel per letter.",
  "jump4love": "VRT NWS noemt Jump4Love (J4L) als voorbeeld van een louche site met **nepprofielen en gestolen foto's**, waar gebruikers met callcenter-medewerkers of AI chatten zonder kans op een echte date.",
  "AI en emotie": "Het VRT-onderzoek toonde aan dat AI-modellen emotionele gesprekken simuleren, puur om gebruikers zo lang mogelijk verslaafd te houden aan de chat, waardoor ze duizenden euro's verliezen.",
  "kwetsbare singles": "VRT NWS waarschuwt dat vooral oudere en eenzame singles een makkelijk doelwit zijn voor deze fraude, omdat ze hopeloos verliefd kunnen worden op een **persoon die niet bestaat**.",
  "internationale fraude": "Uit het VRT-artikel bleek dat de fraude wordt gerund via postbusfirma's op Cyprus en in Schotland, met intrigerende banden tot in de internationale politiek.",
  "peter opgelicht crypto": "Volgens HLN werd Peter Van Welden slachtoffer van een georganiseerde oplichting via WhatsApp, waarbij hij door een nep-onderneemster werd verleid tot investeren in een vervalst crypto-platform en zo 300.000 euro verloor.",
  "pig butchering": "Dit is de naam voor de oplichtingsmethode waarbij fraudeurs, zoals bij Peter, eerst langdurig vertrouwen opbouwen om het slachtoffer emotioneel te binden, waarna ze financieel toeslaan.",
  "oplichting gevolgen": "Het verhaal van Peter in HLN toont de zware gevolgen van oplichting: hij verloor niet alleen zijn spaargeld, maar ook zijn relatie en zijn zelfvertrouwen, door de schaamte en het zwijgen over de fraude.",
  "fraude psychologie": "HLN benadrukt dat deze fraudeurs psychologisch getraind zijn om in te spelen op de emoties en het vertrouwen van het slachtoffer, waardoor zelfs slimme mensen denken dat 'zij het zelf wel kunnen oplossen'.",
  "rode vlaggen fraude": "Volgens Peter zijn de belangrijkste 'rode vlaggen' bij oplichting: berichten van onbekende nummers, het creÃ«ren van druk of urgentie, en de eis voor extra stortingen om je geld 'terug te krijgen'.",

  // EXTRA LEERSTOF UIT PAV-THEMA'S
  "levende natuur": "Levende natuur bestaat uit organismen die groeien, ademen, zich voortplanten en reageren op prikkels.",
  "niet-levende natuur": "Niet-levende natuur bevat elementen zoals water, lucht, rotsen en bodem; ze leven niet maar beÃ¯nvloeden organismen wel.",
  "organisme": "Een organisme is een levend wezen, zoals een mens, dier, plant, schimmel of bacterie.",
  "ecosysteem": "Een ecosysteem is een geheel van levende en niet-levende factoren die elkaar in een gebied beÃ¯nvloeden.",
  "voedselketen": "Een voedselketen toont wie wie eet in de natuur: producenten, consumenten en opruimers.",
  "verleden tijd": "De verleden tijd gebruik je om te vertellen wat er vroeger gebeurde; vaak eindigt de persoonsvorm op -te/-de of was/waren.",
  "werkwoord": "Een werkwoord geeft aan wat iemand doet, wat er gebeurt of in welke toestand iets is.",
  "zinsbouw": "Zinsbouw is de manier waarop woorden in een zin staan zodat de boodschap duidelijk en correct is.",
  "omtrek": "De omtrek is de totale lengte van de rand van een figuur.",
  "oppervlakte": "De oppervlakte is de grootte van het vlak binnen de randen van een figuur, meestal uitgedrukt in cmÂ² of mÂ².",
  "fictie": "Fictie is een verzonnen verhaal, ook al kan het lijken op de werkelijkheid.",
  "non-fictie": "Non-fictie is een informatieve tekst die gebaseerd is op feiten.",
  "afronden": "Afronden betekent een getal vervangen door een eenvoudiger, dichtbij liggend getal om sneller te kunnen schatten.",
  "schatten": "Schatten is een redelijke benadering maken van een uitkomst zonder exact te rekenen.",
  "communicatiemodel": "Het communicatiemodel beschrijft hoe een zender via een boodschap en kanaal informatie doorgeeft aan een ontvanger.",
  "zender": "De zender is degene die de boodschap opstelt en verstuurt.",
  "ontvanger": "De ontvanger is degene voor wie de boodschap bedoeld is en die ze interpreteert.",
  "boodschap": "De boodschap is de inhoud die je wil overbrengen in gesproken, geschreven of visuele vorm.",
  "kanaal": "Het kanaal is het medium waarmee je communiceert, zoals chat, e-mail, telefoon of gesprek.",
  "ruis": "Ruis is alles wat de communicatie verstoort, zoals lawaai, onduidelijke taal of technische problemen.",
  "jan frans vonck": "Jan Frans Vonck was een jurist en leider van de vonckisten tijdens de Brabantse Omwenteling. Hij wilde het feodale systeem afschaffen en pleitte voor een meer democratisch en centralistisch bestuur, geÃ¯nspireerd door de Franse Revolutie.",
  "hendrik van der noot": "Hendrik van der Noot was een politicus en leider van de statisten tijdens de Brabantse Omwenteling. Hij verdedigde de oude privileges en werd eerste minister van de Verenigde Nederlandse Staten in 1790.",
  "brabantse omwenteling": "De Brabantse Omwenteling (1789â€“1790) was een opstand tegen het Oostenrijkse bewind die leidde tot de oprichting van de Verenigde Nederlandse Staten.",
  "vonckisten": "De vonckisten waren een revolutionaire groep die hervormingen, gelijkheid en een sterk centraal bestuur wilden.",
  "statisten": "De statisten waren een conservatieve groep die de oude privileges en macht van de standen wilden behouden.",
  "verenigde nederlandse staten": "De Verenigde Nederlandse Staten waren een onafhankelijke staat die in 1790 ontstond maar slechts Ã©Ã©n jaar bestond.",
  "boerenkrijg": "De Boerenkrijg (1798) was een volksopstand tegen de Franse bezetting en verplichte maatregelen zoals dienstplicht en belastingen.",
  "belgische revolutie": "De Belgische Revolutie van 1830 leidde tot het ontstaan van BelgiÃ« als onafhankelijke staat.",
  "onderdaan": "Een onderdaan is iemand die onder het gezag van een vorst of overheid leeft.",
  "heer": "Een heer is een persoon met macht en rechten over een gebied en de mensen die er wonen.",
  "horige": "Een horige is een boer die gebonden is aan het land van een heer en daarvoor moet werken.",
  "feodalisme": "Feodalisme is een bestuurssysteem waarbij heren macht hadden over land en onderdanen.",
  "privileges": "Privileges zijn speciale rechten die alleen voor bepaalde groepen gelden.",
  "standenmaatschappij": "De standenmaatschappij is een samenleving verdeeld in groepen met ongelijke rechten.",
  "centralisatie": "Centralisatie betekent dat de macht wordt samengebracht bij Ã©Ã©n centrale overheid.",
  "revolutie": "Een revolutie is een snelle en ingrijpende verandering van het bestuur of de samenleving.",
  "verlichting": "De Verlichting was een ideeÃ«nstroming die rede, vrijheid en gelijkheid benadrukte.",
  "grondwet": "Een grondwet is een document met de belangrijkste regels van een staat.",
  "soevereiniteit": "Soevereiniteit is de hoogste macht binnen een land.",
  "dienstplicht": "Dienstplicht betekent dat burgers verplicht zijn om in het leger te dienen.",
  "feedback": "Feedback is de reactie van de ontvanger waarmee je weet of de boodschap begrepen is."

};
const CANONICAL_KNOWLEDGE = JSON.parse(JSON.stringify(KNOWLEDGE));
const ASSIGNMENTS = {
  "ai": "Geef een voorbeeld van hoe AI wordt gebruikt in je dagelijks leven en licht toe.",
  "voorbeeld ai": "Noem een specifieke chatbot of AI-assistent en beschrijf kort waarvoor je die zou gebruiken.",
  "machine learning": "Zoek een voorbeeld van een applicatie die leert van jouw data (bv. Spotify, Netflix) en leg uit hoe dit machine learning is.",
  "deep learning": "Zoek een voorbeeld van deep learning (bv. gezichtsherkenning) en leg uit waarom het nuttig is.",
  "sociaal welzijn": "Bedenk een situatie op school of stage waar het sociale welzijn van een leerling/cliÃ«nt verbetering nodig heeft.",
  "pedagogisch werk": "Beschrijf een concrete begeleidingsactiviteit die je zou uitvoeren in het kader van pedagogisch werk.",
  "ethiek": "Geef een voorbeeld van een ethische vraag die je je stelt bij het gebruik van sociale media.",
  "privacy": "Wat zijn twee concrete stappen die je kunt nemen om je online privacy te verbeteren?",
  "multifactorauthenticatie": "Geef twee voorbeelden van een tweede factor die je kunt gebruiken bij multifactorauthenticatie.",
  "wachtwoord hygiÃ«ne": "Waarom is het gebruik van een wachtwoordmanager een belangrijk onderdeel van 'wachtwoord hygiÃ«ne'?",
  "fraude psychologie": "Geef een voorbeeld van hoe fraudeurs 'tijdsdruk' kunnen gebruiken als een psychologische truc.",
  "rode vlaggen fraude": "Noem Ã©Ã©n 'rode vlag' in een online conversatie die je onmiddellijk zou doen stoppen met chatten.",
  "oplichting gevolgen": "Welke niet-financiÃ«le gevolgen kunnen slachtoffers van fraude ondervinden (bv. naast geldverlies)?",
  "pig butchering": "Wat is het cruciale psychologische element in de 'pig butchering'-methode om het slachtoffer te overtuigen?",
  "kwetsbare singles": "Wat maakt oudere, eenzame mensen extra kwetsbaar voor emotionele manipulatie door fraudeurs?",
  "levende natuur": "Noem drie kenmerken waaraan je kunt herkennen dat iets levende natuur is.",
  "niet-levende natuur": "Geef drie voorbeelden van niet-levende natuur en leg per voorbeeld uit waarom het niet leeft.",
  "organisme": "Kies Ã©Ã©n organisme uit je omgeving en beschrijf hoe het zich aanpast aan zijn leefomgeving.",
  "ecosysteem": "Beschrijf een lokaal ecosysteem (bv. park of vijver) met minstens twee levende en twee niet-levende factoren.",
  "voedselketen": "Maak een eenvoudige voedselketen met minstens vier schakels en duid producent en consumenten aan.",
  "verleden tijd": "Schrijf vijf zinnen in de verleden tijd over wat je gisteren deed en markeer de persoonsvorm.",
  "werkwoord": "Zoek in een krantenartikel vijf werkwoorden en bepaal per werkwoord de tijd.",
  "zinsbouw": "Herschrijf een onduidelijke zin zodat de woordvolgorde correct en helder is.",
  "omtrek": "Meet de omtrek van een voorwerp in de klas en toon je berekening.",
  "oppervlakte": "Bereken de oppervlakte van je bank of tafelblad in cmÂ² en in mÂ².",
  "fictie": "Leg uit waarom een gekozen boek of film onder fictie valt met twee argumenten.",
  "non-fictie": "Vergelijk een non-fictietekst met een fictietekst en noem twee duidelijke verschillen.",
  "afronden": "Rond de getallen 4.781, 267 en 0,049 af op een passend niveau en leg je keuze uit.",
  "schatten": "Maak een schatting van een rekensom en controleer nadien met de exacte uitkomst hoe dicht je zat.",
  "communicatiemodel": "Analyseer een recent bericht dat je verstuurde en benoem zender, ontvanger, kanaal en feedback.",
  "zender": "Geef een voorbeeld waarbij de zender zijn boodschap moest aanpassen aan de doelgroep.",
  "ontvanger": "Beschrijf een situatie waarin de ontvanger een boodschap anders begreep dan bedoeld.",
  "boodschap": "Herschrijf een lange boodschap in drie duidelijke kernzinnen.",
  "kanaal": "Vergelijk twee communicatiekanalen voor dezelfde boodschap en kies welk kanaal het meest geschikt is.",
  "ruis": "Geef twee voorbeelden van ruis bij digitale communicatie en hoe je die voorkomt.",
  "feedback": "Formuleer constructieve feedback op een klasopdracht volgens de ik-boodschap.",
  "natuur": "Zoek een natuurgebied in jouw regio en beschrijf drie kenmerken.",
  "industrieel": "Zoek een industrieterrein in de buurt en beschrijf de functie ervan.",
  "landelijk": "Wat zijn de voor- en nadelen van wonen in een landelijke omgeving?",
  "stedelijk": "Welke invloed heeft de hoge bevolkingsdichtheid in een stedelijke omgeving op het verkeer?",
  "toeristisch": "Noem een toeristische trekpleister in Vlaanderen en leg uit waarom mensen die plaats bezoeken.",
  "cognitieve vermogens": "Noem twee cognitieve vermogens die je nodig hebt om een moeilijke puzzel op te lossen.",
  "windroos": "Teken een windroos en benoem alle vier de hoofdrichtingen en de vier tussenrichtingen.",
  "legende": "Waarom is de 'legende' essentieel voor het correct begrijpen en interpreteren van een kaart?",
  "schaal": "Als de 'schaal' van een kaart 1:50.000 is, hoeveel centimeter in werkelijkheid is 2 centimeter op de kaart?",
  "staatkundige kaarten": "Waarvoor gebruik je een 'staatkundige kaart' (bv. een overzicht van een continent) in vergelijking met een 'reliÃ«fkaart'?",
  "reliÃ«fkaarten": "Welke kleur wordt op een 'reliÃ«fkaart' vaak gebruikt om bergachtige gebieden aan te duiden?",
  

  // ðŸ”µ Slimmere opdrachten
  "ethiek in het onderwijs": "Welke ethische overweging maak je bij het beoordelen van werkstukken die (deels) door AI zijn gemaakt?",
  "ethisch dilemma": "Formuleer een ethisch dilemma dat kan ontstaan bij het gebruik van AI in de gezondheidszorg.",
  "discriminatie door ai": "Bedenk een scenario waarin AI-software onbedoeld zou kunnen discrimineren bij het selecteren van kandidaten voor een universiteit.",
  "energieverbruik van ai": "Zoek op hoeveel stroom (ongeveer) Ã©Ã©n keer een afbeelding genereren met een populaire AI-tool kost, en vergelijk dit met een alledaagse activiteit.",
  "agi": "Wat is het grootste ethische risico als AGI ooit zou bestaan?",
  "ai en emotie": "Waarom is het nabootsen van menselijke emoties door AI riskant in de context van online fraude?",
  "datingfraude ai": "Op welke twee manieren (naast gegenereerde berichten) maakt een louche datingsite gebruik van de kwetsbaarheid van singles?",
  "jump4love": "Leg uit waarom sites zoals 'Jump4Love' hun chatmodellen vaak emoties laten simuleren.",
  "senaat lek": "Welke maatregel had het datalek bij de Belgische Senaat vrijwel zeker kunnen voorkomen?",
  "infostealer": "Leg in eigen woorden uit hoe een 'infostealer' aan je gegevens komt en wat er daarna mee gebeurt.",
  "internationale fraude": "Wat is de belangrijkste reden waarom het moeilijk is om de daders van 'internationale fraude' te vervolgen?",
  "peter opgelicht crypto": "Beschrijf de belangrijkste stap in de oplichtingsmethode die leidde tot het financiÃ«le verlies van 'Peter'.",
  "autonoom": "Wat is het verschil tussen een traditionele auto en een autonome auto in termen van bestuurdersinput?",
  "zelfrijdende auto": "Welke sensoren (bv. camera's, lidar) zijn essentieel voor een zelfrijdende auto om veilig te kunnen functioneren?",
  "voorbeeld zelfrijdende auto": "Vergelijk de mate van autonomie tussen een Tesla in 'Autopilot' en de 'autonome shuttle' in Leuven.",
  "autonome shuttle": "Wat is het grootste voordeel van een autonome shuttle in een afgesloten, vaste route?",
  "ava technologie": "Leg uit waarom de keuze van een 'beste thumbnail' belangrijk is voor een YouTuber.",
  "ruimtelijk bewustzijn": "Welke van de vier sleutelcompetenties (bv. in MAVO/PAV) vind je persoonlijk het belangrijkst en waarom?",
  "ruimtelijk relationeel denken": "Geef een voorbeeld van een relatie tussen een natuurlijk proces (bv. een rivier) en een menselijk proces (bv. de locatie van een stad).",
  "aardrijkskunde": "Wat is het verschil in focus tussen de oude, louter beschrijvende aardrijkskunde en de moderne, analytische aardrijkskunde?",
  "fysische geografie": "Noem een proces dat bestudeerd wordt door de fysische geografie (bv. erosie of klimaatverandering).",
  "sociale geografie": "Noem een onderwerp dat bestudeerd wordt door de sociale geografie (bv. migratiepatronen of verstedelijking).",
  "lokaliseren": "Zoek een coÃ¶rdinaat (bv. GPS-coÃ¶rdinaat) van je school en leg uit waarom dit 'absoluut situeren' is.",
  "oriÃ«nteren": "Leg uit hoe je je met behulp van de zon en een horloge zou kunnen oriÃ«nteren.",
  "situeren": "Leg het verband tussen 'lokaliseren' en 'oriÃ«nteren' in de context van 'situeren'.",
  "geografische hulpbronnen": "Noem drie voorbeelden van 'geografische hulpbronnen' die je in de klas zou kunnen gebruiken.",
  "atlas": "Hoe helpt de structuur van een atlas (bv. de indeling) je bij het vinden van informatie over verschillende 'schaalniveaus'?",
  "GIS-viewers": "Geef twee concrete voorbeelden van hoe een 'GIS-viewer' (bv. Geopunt Vlaanderen) het ruimtelijk bewustzijn kan vergroten.",
  "breukschaal": "Wat betekent de 'breukschaal' 1:250 in de context van een plattegrond van een gebouw?",
  "lijnschaal": "Wat is het voordeel van een 'lijnschaal' ten opzichte van een 'breukschaal' als je een kaart vergroot of verkleint?",
  "thematische kaarten": "Welk specifiek onderwerp zou je terugvinden op een thematische kaart van BelgiÃ« over de bevolking?",
  "historisch referentie kader": "Maak een beknopt historisch referentiekader (minstens drie data) voor de geschiedenis van jouw gemeente/stad en noteer de belangrijkste domeinen (P, S, C, E).",
  "canon van vlaanderen": "Kies Ã©Ã©n Canon-venster uit je unit en leg in 4 zinnen uit wat de gebeurtenis verandert in het dagelijkse leven van mensen.",
  "het verhaal van vlaanderen": "Koppel Ã©Ã©n scÃ¨ne uit de reeks aan je Canon-bron en noteer: oorzaak, gevolg en waarom dit past in het grotere verhaal.",
  "wetboek van napoleon": "Geef 2 effecten van het wetboek: Ã©Ã©n dat voor meer duidelijkheid zorgde en Ã©Ã©n punt dat nog ongelijk bleef.",
  "liberale grondwet": "Kies Ã©Ã©n grondrecht en leg uit hoe dat recht vandaag zichtbaar is op school, in media of in de samenleving.",
  "grondrechten": "Vergelijk een situatie mÃ©t en zonder grondrechten en noteer in 3 zinnen wat dat verandert voor burgers.",
  "eerste treinrit": "Maak een klein oorzaak-gevolgschema: trein -> economie, trein -> werk, trein -> dagelijks leven.",
  "industrialisering": "Noem 2 voordelen en 2 nadelen van industrialisering voor gewone gezinnen in de 19e eeuw.",
  "emilie claeys": "Schrijf 4 zinnen: welk onrecht wilde Emilie Claeys aanpakken en welke rechten lijken vandaag vanzelfsprekend door die strijd?",
  "emancipatie": "Geef een voorbeeld van een recht dat via emancipatiestrijd sterker is geworden en leg uit waarom.",
  "dossinkazerne": "Formuleer 2 lessen voor vandaag uit het verhaal van de Dossinkazerne rond uitsluiting, racisme en burgerschap.",
  "holocaust": "Leg uit waarom herinneringseducatie belangrijk is voor democratie en mensenrechten in het heden.",
  "mensenrechten": "Kies Ã©Ã©n mensenrecht en geef een concreet voorbeeld van hoe je dat recht kan beschermen in het dagelijks leven.",
  "de euro": "Geef Ã©Ã©n voordeel en Ã©Ã©n uitdaging van een gezamenlijke munt voor burgers in Vlaanderen.",
  "europese samenwerking": "Noem een Europese beslissing die je dagelijks leven beÃ¯nvloedt en leg het effect uit in 3 zinnen.",
  "historisch redeneren": "Beantwoord over je unit: wat is de oorzaak, wat is het gevolg op korte termijn en wat verandert op lange termijn?"

};

function normalizeTopic(topic){ return topic.trim().toLowerCase(); }
function buildTopicIndex(source){ const index={}; Object.entries(source).forEach(([k,v])=>{ index[normalizeTopic(k)]=v; }); return index; }
function escapeRegExp(value){ return value.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
function parseTeachCommand(input,prefix){
  const escapedPrefix=escapeRegExp(prefix);
  const regex=new RegExp(`^${escapedPrefix}\\s*([^=]+)\\s*=\\s*(.+)$`,'i');
  const match=input.match(regex);
  if(!match) return null;
  return { topic: normalizeTopic(match[1]), text: match[2].trim() };
}
function saveCustomLeerstof(){
  const payload={ knowledge: customKnowledge, assignments: customAssignments };
  localStorage.setItem(CUSTOM_STORAGE_KEY, JSON.stringify(payload));
}
function loadCustomLeerstof(){
  try{
    const raw=localStorage.getItem(CUSTOM_STORAGE_KEY);
    if(!raw) return;
    const parsed=JSON.parse(raw);
    const loadedKnowledge=parsed?.knowledge ?? {};
    const loadedAssignments=parsed?.assignments ?? {};
    Object.entries(loadedKnowledge).forEach(([topic,text])=>{ if(text) knowledgeIndex[normalizeTopic(topic)]=text; });
    Object.entries(loadedAssignments).forEach(([topic,text])=>{ if(text) assignmentsIndex[normalizeTopic(topic)]=text; });
    customKnowledge=buildTopicIndex(loadedKnowledge);
    customAssignments=buildTopicIndex(loadedAssignments);
  }catch(_){
    customKnowledge={};
    customAssignments={};
  }
}
function getKnowledge(topic){ return knowledgeIndex[normalizeTopic(topic)]; }
function getAssignment(topic){ return assignmentsIndex[normalizeTopic(topic)]; }

const baseKnowledgeIndex = buildTopicIndex(KNOWLEDGE);
const baseAssignmentsIndex = buildTopicIndex(ASSIGNMENTS);
const knowledgeIndex = { ...baseKnowledgeIndex };
const assignmentsIndex = { ...baseAssignmentsIndex };
let customKnowledge = {};
let customAssignments = {};
loadCustomLeerstof();

// -------------------------
// STATE
// -------------------------
let isChatActive=false, escalation=0, memory={}, isDisabled=false;
let awaitingStep=null;

// -------------------------
// DOM
// -------------------------
const messagesEl=document.getElementById('messages');
const inputEl=document.getElementById('userInput');
const sendBtn=document.getElementById('sendButton');
const chips=document.querySelectorAll('.chip-btn[data-action]');
const howBtn=document.getElementById('howBtn');
const chatTitleEl=document.getElementById('chatTitle');
const params=new URLSearchParams(window.location.search);
const themaNaam=params.get('thema');
if(themaNaam){
  chatTitleEl.textContent='ðŸ¤– Chattie â€” '+themaNaam;
}

// -------------------------
// HELPERS
// -------------------------
function safeText(text){ const div=document.createElement('div'); div.textContent=text; return div.innerHTML; }
function appendMessage(text,who='bot'){ const el=document.createElement('div'); el.className='msg '+who; const b=document.createElement('div'); b.className='bubble '+who; b.innerHTML=safeText(text).replace(/\\n/g,'<br>'); el.appendChild(b); messagesEl.appendChild(el); messagesEl.scrollTop=messagesEl.scrollHeight; }
function updateUI(){}
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
async function showTyping(){ appendMessage("Chattie denkt even na...",'bot'); await sleep(TYPING_MS); messagesEl.lastChild?.remove(); }

// -------------------------
// CHAT FUNCTIES
// -------------------------
function handleUserInput(){
  if(isDisabled){ appendMessage("ðŸš« Chattie is uitgeschakeld. Typ '"+RESET_CODE+"' om te resetten.","bot"); return; }
  const input=inputEl.value.trim();
  if(!input) return;
  appendMessage(input,'user'); inputEl.value='';
  processInput(input);
}

async function processInput(input){
  const normalizedInput=input.trim().toLowerCase();
  if(FORBIDDEN.some(w=>normalizedInput.includes(w))){ escalation++; appendMessage("â— Dat was niet gepast. Blijf beleefd a.u.b.",'bot'); return; }
  if(normalizedInput===RESET_CODE){
    escalation=0; isDisabled=false; memory={};
    customKnowledge={}; customAssignments={};
    Object.keys(knowledgeIndex).forEach(topic=>{ delete knowledgeIndex[topic]; });
    Object.keys(assignmentsIndex).forEach(topic=>{ delete assignmentsIndex[topic]; });
    Object.assign(knowledgeIndex, baseKnowledgeIndex);
    Object.assign(assignmentsIndex, baseAssignmentsIndex);
    localStorage.removeItem(CUSTOM_STORAGE_KEY);
    appendMessage("ðŸ”„ Chattie is herstart!",'bot');
    updateUI();
    return;
  }
  if(normalizedInput==="start"){ isChatActive=true; appendMessage("ðŸŽ‰ Hallo! Typ 'leg uit: ai' om te starten.",'bot'); updateUI(); return; }
  if(normalizedInput==="einde"){ isChatActive=false; appendMessage("ðŸ‘‹ Tot later!",'bot'); updateUI(); return; }

  const teachKnowledge=parseTeachCommand(input,"leer:");
  if(teachKnowledge){
    customKnowledge[teachKnowledge.topic]=teachKnowledge.text;
    knowledgeIndex[teachKnowledge.topic]=teachKnowledge.text;
    saveCustomLeerstof();
    appendMessage(`âœ… Nieuwe leerstof opgeslagen voor '${teachKnowledge.topic}'. Gebruik nu: leg uit: ${teachKnowledge.topic}`,'bot');
    return;
  }

  const teachAssignment=parseTeachCommand(input,"opdracht voor:");
  if(teachAssignment){
    customAssignments[teachAssignment.topic]=teachAssignment.text;
    assignmentsIndex[teachAssignment.topic]=teachAssignment.text;
    saveCustomLeerstof();
    appendMessage(`âœ… Opdracht opgeslagen voor '${teachAssignment.topic}'.`,'bot');
    return;
  }

  if(normalizedInput==="toon leerstof"){
    const customTopics=Object.keys(customKnowledge);
    if(!customTopics.length){ appendMessage("Er is nog geen extra leerstof opgeslagen. Gebruik: leer: onderwerp = uitleg",'bot'); return; }
    appendMessage("ðŸ“š Opgeslagen extra leerstof: "+customTopics.sort().join(", "),'bot');
    return;
  }

  if(normalizedInput.startsWith("leg uit:")){
    const topic=normalizeTopic(input.replace(/^leg uit:/i,"").trim());
    const knowledge=getKnowledge(topic);
    if(knowledge){
      await showTyping();
      appendMessage("Hier is een uitleg over '"+topic+"':",'bot');
      appendMessage(knowledge,'bot');
      memory.lastTopic=topic;
      updateUI();
    } else {
      appendMessage("Sorry, ik ken dat onderwerp nog niet. Voeg het toe met: leer: onderwerp = uitleg",'bot');
    }
    return;
  }

  if(normalizedInput==="opdracht"){
    const assignment = memory.lastTopic ? getAssignment(memory.lastTopic) : null;
    if(assignment) appendMessage("ðŸ“ Opdracht: "+assignment,'bot');
    else appendMessage("Geen actieve opdracht. Leer eerst een onderwerp via 'leg uit: ...' of voeg er Ã©Ã©n toe met 'opdracht voor: onderwerp = ...'",'bot');
    return;
  }

  appendMessage("ðŸ¤” Sorry, dat begrijp ik niet helemaal. Tip: gebruik 'leer: onderwerp = uitleg' om mij nieuwe leerstof te geven.",'bot');
}

// -------------------------
// EVENTS
// -------------------------
sendBtn.addEventListener('click',handleUserInput);
inputEl.addEventListener('keydown',e=>{ if(e.key==='Enter') handleUserInput(); });

chips.forEach(chip=>{
  chip.addEventListener('click',()=>{
    const action=chip.dataset.action;
    if(!memory.lastTopic && ['samenvat','kernwoorden','assignment','stap','example'].includes(action)){
      appendMessage("Leer eerst iets via 'leg uit: ...'",'bot'); return;
    }
    switch(action){
      case "more": appendMessage("ðŸ’¡ Gebruik 'leg uit: <onderwerp>' voor uitleg",'bot'); break;
      case "example": appendMessage("Stuur een voorbeeld met 'voorbeeld: <jouw voorbeeld>'",'bot'); break;
      case "dontget": processInput("ik snap het niet"); break;
      case "assignment": if(memory.lastTopic){ const assignment=getAssignment(memory.lastTopic); appendMessage(assignment?"ðŸ“ Opdracht: "+assignment:"Nog geen opdracht voor dit onderwerp.",'bot'); } break;
      case "stap": appendMessage("Gebruik 'leg uit: ...' om uitleg in stappen te krijgen.",'bot'); break;
      case "samenvat": { const knowledge=getKnowledge(memory.lastTopic); appendMessage(knowledge?"ðŸ“ Samenvatting: "+knowledge:"Nog geen samenvatting voor dit onderwerp.",'bot'); break; }
      case "kernwoorden": { const knowledge=getKnowledge(memory.lastTopic)||""; appendMessage("ðŸ”‘ Kernwoorden: "+(knowledge?knowledge.split(" ").slice(0,5).join(", "):"geen"),'bot'); break; }
    }
  });
});

howBtn.addEventListener('click',()=>{ appendMessage("ðŸ“š Gebruik 'leg uit: <onderwerp>' voor uitleg, 'opdracht' voor een oefening. Nieuwe leerstof toevoegen? Typ: leer: onderwerp = uitleg en opdracht voor: onderwerp = opdracht.",'bot'); });

if(themaNaam){
  const themaLower = themaNaam.toLowerCase();
  if(themaLower.includes('thema 9') || themaLower.includes('geschiedenis')){
    appendMessage("ðŸ“– Welkom bij Thema 9. Vraag bv. 'leg uit: wetboek van napoleon' of 'leg uit: dossinkazerne'.",'bot');
  }
}

updateUI();
</script>
</body>
</html>
