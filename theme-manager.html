<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAV-O Theme Manager</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
--primary:#0f766e;
--bg:#f1f5f9;
--white:#ffffff;
--border:#e2e8f0;
--text:#1e293b;
}

body{
margin:0;
font-family:'Nunito',sans-serif;
background:var(--bg);
display:flex;
}

.sidebar{
width:240px;
background:white;
height:100vh;
border-right:1px solid var(--border);
padding:20px;
position:fixed;
}

.sidebar h2{
color:var(--primary);
}

.sidebar a{
display:block;
padding:10px;
border-radius:8px;
text-decoration:none;
font-weight:700;
color:var(--text);
margin-bottom:5px;
}

.sidebar a:hover{
background:#e6f3f0;
color:var(--primary);
}

.main{
margin-left:240px;
padding:30px;
display:grid;
grid-template-columns:1fr 1.1fr;
gap:30px;
width:100%;
}

/* EDITOR */

.editor{
background:white;
padding:20px;
border-radius:14px;
box-shadow:0 6px 18px rgba(0,0,0,0.08);
overflow:auto;
max-height:90vh;
}

.editor input,
.editor textarea,
.editor select{
width:100%;
padding:8px;
margin-bottom:10px;
border-radius:6px;
border:1px solid var(--border);
font-family:inherit;
}

.editor button{
background:var(--primary);
color:white;
border:none;
padding:8px 12px;
border-radius:6px;
cursor:pointer;
font-weight:700;
margin-bottom:10px;
}

.unit-box{
border:1px solid var(--border);
padding:10px;
border-radius:8px;
margin-bottom:12px;
background:#f8fafc;
}

/* PREVIEW */

.preview{
background:white;
border-radius:14px;
overflow:hidden;
box-shadow:0 6px 18px rgba(0,0,0,0.08);
}

.preview-header{
background:#14b8a6;
color:white;
padding:20px;
text-align:center;
}

.preview-body{
padding:15px;
}

.unit-card{
border:2px solid #bce7e1;
border-radius:10px;
padding:10px;
margin-bottom:8px;
background:#f0fdfa;
}

.mascot{
width:100%;
border-radius:10px;
margin-top:10px;
}

</style>
</head>

<body>

<div class="sidebar">
<h2>PAV-O</h2>
<a href="teacher-dashboard.html">Dashboard</a>
<a href="index.html">Leerlingomgeving</a>
</div>

<div class="main">

<!-- ================= EDITOR ================= -->

<div class="editor">

<h2>Thema bouwen</h2>

<input id="title" placeholder="Titel">
<textarea id="description" placeholder="Beschrijving"></textarea>
<input id="focus" placeholder="Focus van dit thema">

<textarea id="skills" placeholder="Wat oefen je? (komma gescheiden)"></textarea>

<hr>

<h3>Units</h3>
<div id="unitsContainer"></div>

<button onclick="addUnit()">+ Unit toevoegen</button>

<hr>

<button onclick="saveTheme()">ðŸ’¾ Thema opslaan</button>

</div>

<!-- ================= PREVIEW ================= -->

<div class="preview">

<div class="preview-header">
<h1 id="pTitle">Thema titel</h1>
<p id="pDesc">Beschrijving</p>
</div>

<div class="preview-body">

<h3>Units</h3>
<div id="previewUnits"></div>

</div>

</div>

</div>

<script src="./firebase.js"></script>

<script>

let units=[];

/* ================= UNITS ================= */

function addUnit(){

if(units.length>=12){
alert("Max 12 units");
return;
}

const unit={
title:"",
active:true,
exercises:[]
};

units.push(unit);
renderUnits();
}

function addExercise(unitIndex){

const exercise={
type:"meerkeuze",
question:"",
answers:[""],
correct:"",
xp:10,
image:""
};

units[unitIndex].exercises.push(exercise);
renderUnits();
}

function renderUnits(){

const container=document.getElementById("unitsContainer");
const preview=document.getElementById("previewUnits");

container.innerHTML="";
preview.innerHTML="";

units.forEach((unit,uIndex)=>{

/* ===== EDITOR ===== */

const unitDiv=document.createElement("div");
unitDiv.className="unit-box";

unitDiv.innerHTML=`

<h4>Unit ${uIndex+1}</h4>

<input placeholder="Unit titel"
value="${unit.title}"
oninput="units[${uIndex}].title=this.value;renderPreview()">

<label>Actief</label>
<select onchange="units[${uIndex}].active=this.value==='true'">
<option value="true">Ja</option>
<option value="false">In ontwikkeling</option>
</select>

<button onclick="addExercise(${uIndex})">+ Oefening</button>

<div id="exercises${uIndex}"></div>

`;

container.appendChild(unitDiv);

/* ===== EXERCISES ===== */

const exContainer=unitDiv.querySelector(`#exercises${uIndex}`);

unit.exercises.forEach((ex,eIndex)=>{

const exDiv=document.createElement("div");

exDiv.innerHTML=`

<hr>
<h5>Vraag ${eIndex+1}</h5>

<select onchange="units[${uIndex}].exercises[${eIndex}].type=this.value">
<option>meerkeuze</option>
<option>open</option>
<option>gesloten</option>
<option>suggestief</option>
<option>controle</option>
</select>

<input placeholder="Vraag"
value="${ex.question}"
oninput="units[${uIndex}].exercises[${eIndex}].question=this.value">

<input placeholder="Mogelijke antwoorden (komma)"
oninput="units[${uIndex}].exercises[${eIndex}].answers=this.value.split(',')">

<input placeholder="Juiste antwoord"
oninput="units[${uIndex}].exercises[${eIndex}].correct=this.value">

<input type="number" value="${ex.xp}"
oninput="units[${uIndex}].exercises[${eIndex}].xp=this.value">

<input placeholder="Afbeelding URL"
oninput="units[${uIndex}].exercises[${eIndex}].image=this.value">

`;

exContainer.appendChild(exDiv);

});

/* ===== PREVIEW ===== */

const pDiv=document.createElement("div");
pDiv.className="unit-card";

if(unit.active){

pDiv.innerHTML=`
<h4>${unit.title || "Unit"}</h4>
<button>Start</button>
`;

}else{

pDiv.innerHTML=`
<h4>${unit.title || "Unit"}</h4>
<img class="mascot" src="img/images/pavobouwmascotte.png">
`;

}

preview.appendChild(pDiv);

});

renderPreview();
}

/* ================= PREVIEW HEADER ================= */

function renderPreview(){

document.getElementById("pTitle").innerText=
document.getElementById("title").value || "Thema titel";

document.getElementById("pDesc").innerText=
document.getElementById("description").value || "Beschrijving";

}

/* ================= SAVE ================= */

async function saveTheme(){

await window.firebaseReady;

const themeData={
title:document.getElementById("title").value,
description:document.getElementById("description").value,
focus:document.getElementById("focus").value,
skills:document.getElementById("skills").value.split(","),
units:units,
createdAt:firebase.firestore.FieldValue.serverTimestamp(),
active:true
};

await window.db.collection("themes").add(themeData);

alert("Thema opgeslagen");

}

/* ================= INIT ================= */

document.getElementById("title").oninput=renderPreview;
document.getElementById("description").oninput=renderPreview;

</script>

</body>
</html>

