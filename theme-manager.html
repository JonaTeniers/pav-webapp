<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PAV-O | Theme Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
--primary:#0b4da2;
--green:#10b981;
--danger:#ef4444;
--bg:#f0f4f8;
--white:#ffffff;
--border:#e2e8f0;
--text:#1e293b;
}
body{
margin:0;
font-family:'Nunito',sans-serif;
background:var(--bg);
display:flex;
}
.sidebar{
width:240px;
background:white;
height:100vh;
position:fixed;
border-right:1px solid var(--border);
padding:20px;
}
.sidebar h2{color:var(--primary);}
.sidebar a{
display:block;
padding:10px;
border-radius:8px;
text-decoration:none;
font-weight:700;
color:var(--text);
margin-bottom:6px;
}
.sidebar a.active,
.sidebar a:hover{
background:#e0f2fe;
color:var(--primary);
}
.main{
margin-left:240px;
padding:30px;
width:calc(100% - 240px);
}
.editor{
background:white;
padding:25px;
border-radius:16px;
box-shadow:0 4px 12px rgba(0,0,0,0.05);
}
input, textarea, select{
width:100%;
padding:8px;
margin-bottom:10px;
border-radius:8px;
border:1px solid var(--border);
font-family:inherit;
}
button{
padding:8px 14px;
border:none;
border-radius:8px;
cursor:pointer;
font-weight:700;
}
.add-btn{background:var(--primary);color:white;}
.save-btn{background:var(--green);color:white;}
.delete-btn{background:var(--danger);color:white;}

.unit-block{
background:#f8fafc;
padding:15px;
border-radius:12px;
margin-bottom:15px;
border:1px solid var(--border);
}
.exercise-block{
background:#ffffff;
padding:10px;
border-radius:8px;
margin-bottom:8px;
border:1px solid #e5e7eb;
}
.small{
font-size:0.8rem;
color:#64748b;
}
</style>
</head>

<body>

<nav class="sidebar">
<h2>PAV-O</h2>
<a href="#" class="active">Thema Builder</a>
<a href="index.html">Leerlingomgeving</a>
</nav>

<div class="main">
<div class="editor">

<h2>Nieuw Thema</h2>

<label>Titel</label>
<input id="titleInput">

<label>Beschrijving</label>
<textarea id="descInput"></textarea>

<hr>

<h3>Units (max 12)</h3>
<div id="unitsContainer"></div>
<button class="add-btn" onclick="addUnit()">+ Unit toevoegen</button>

<hr>
<h3>Totaal XP: <span id="totalXp">0</span></h3>

<button class="save-btn" onclick="saveTheme()">ðŸ’¾ Thema opslaan</button>

</div>
</div>

<script src="./firebase.js"></script>

<script>

let units = [];

function addUnit(){

if(units.length >= 12){
alert("Maximum 12 units toegestaan.");
return;
}

const newUnit = {
title: "Nieuwe unit",
exercises: []
};

units.push(newUnit);
renderUnits();
}

function addExercise(unitIndex){

if(units[unitIndex].exercises.length >= 10){
alert("Maximum 10 oefeningen per unit.");
return;
}

units[unitIndex].exercises.push({
question:"",
type:"multiple",
options:["","","",""],
correct:0,
xp:10,
image:""
});

renderUnits();
}

function renderUnits(){

const container = document.getElementById("unitsContainer");
container.innerHTML = "";

let totalXp = 0;

units.forEach((unit,uIndex)=>{

let unitXp = 0;

unit.exercises.forEach(ex => unitXp += parseInt(ex.xp||0));
totalXp += unitXp;

let html = `
<div class="unit-block">
<label>Unit titel</label>
<input value="${unit.title}" onchange="updateUnitTitle(${uIndex}, this.value)">

<h4>Oefeningen (max 10)</h4>
`;

unit.exercises.forEach((ex,eIndex)=>{

html += `
<div class="exercise-block">

<label>Vraag</label>
<textarea onchange="updateQuestion(${uIndex},${eIndex},this.value)">${ex.question}</textarea>

<label>Type oefening</label>
<select onchange="updateType(${uIndex},${eIndex},this.value)">
<option value="multiple" ${ex.type=="multiple"?"selected":""}>Meerkeuze</option>
<option value="open" ${ex.type=="open"?"selected":""}>Open vraag</option>
<option value="truefalse" ${ex.type=="truefalse"?"selected":""}>Juist / Fout</option>
</select>

<label>XP voor deze vraag</label>
<input type="number" value="${ex.xp}" onchange="updateXp(${uIndex},${eIndex},this.value)">

<label>Afbeelding URL (optioneel)</label>
<input value="${ex.image}" onchange="updateImage(${uIndex},${eIndex},this.value)">

<button class="delete-btn" onclick="deleteExercise(${uIndex},${eIndex})">Verwijderen</button>

</div>
`;
});

html += `
<p class="small">Unit XP: ${unitXp}</p>
<button class="add-btn" onclick="addExercise(${uIndex})">+ Oefening toevoegen</button>
<button class="delete-btn" onclick="deleteUnit(${uIndex})">Verwijder unit</button>
</div>
`;

container.innerHTML += html;

});

document.getElementById("totalXp").innerText = totalXp;
}

function updateUnitTitle(u,v){ units[u].title=v; }
function updateQuestion(u,e,v){ units[u].exercises[e].question=v; }
function updateType(u,e,v){ units[u].exercises[e].type=v; }
function updateXp(u,e,v){ units[u].exercises[e].xp=parseInt(v); renderUnits(); }
function updateImage(u,e,v){ units[u].exercises[e].image=v; }

function deleteExercise(u,e){
units[u].exercises.splice(e,1);
renderUnits();
}

function deleteUnit(u){
units.splice(u,1);
renderUnits();
}

async function saveTheme(){

if(!titleInput.value){
alert("Geef titel in.");
return;
}

try{

await window.firebaseReady;

await window.db.collection("themes").add({
title: titleInput.value,
description: descInput.value,
units: units,
totalXp: units.reduce((sum,u)=>sum + u.exercises.reduce((s,e)=>s+parseInt(e.xp||0),0),0),
active:true,
createdAt: firebase.firestore.FieldValue.serverTimestamp()
});

alert("Thema opgeslagen!");

units=[];
renderUnits();
titleInput.value="";
descInput.value="";

}catch(error){
console.error(error);
alert("Opslaan mislukt.");
}
}

</script>

</body>
</html>
