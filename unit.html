<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Doel</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800&display=swap" rel="stylesheet">

<style>

body{
font-family:'Nunito',sans-serif;
background:#f1f5f9;
margin:0;
padding:40px;
}

.container{
max-width:1000px;
margin:auto;
}

.card{
background:white;
padding:20px;
border-radius:12px;
box-shadow:0 6px 18px rgba(0,0,0,0.08);
margin-bottom:20px;
}

button{
background:#0f766e;
color:white;
border:none;
padding:10px 18px;
border-radius:8px;
cursor:pointer;
font-weight:700;
}

button:hover{
background:#0b5f58;
}

.answers button{
display:block;
margin:8px 0;
width:100%;
}

img{
max-width:100%;
border-radius:10px;
margin-top:10px;
}

.xp{
font-weight:800;
text-align:right;
margin-bottom:10px;
}

</style>
</head>

<body>

<div class="container">

<h1 id="title">Doel laden...</h1>
<div class="xp" id="xpBox">0 XP</div>

<div id="questionCard" class="card"></div>

<div id="navButtons"></div>

</div>


<script src="./firebase.js"></script>

<script>

let themeId;
let unitIndex;
let themeData;
let unitData;

let questionIndex=0;
let totalXP=0;

/* ================= LOAD ================= */

async function load(){

await window.firebaseReady;

const params=new URLSearchParams(window.location.search);

themeId=params.get("theme");
unitIndex=parseInt(params.get("unit"));

const doc=await window.db.collection("themes").doc(themeId).get();

if(!doc.exists){
document.getElementById("title").innerText="Thema niet gevonden";
return;
}

themeData=doc.data();

unitData=themeData.units?.[unitIndex];

if(!unitData){

document.getElementById("questionCard").innerHTML=`
<img src="img/images/pavobouwmascotte.png">
<h3>Dit doel bestaat nog niet</h3>
`;

return;
}

document.getElementById("title").innerText=unitData.title || "Doel";

showQuestion();

}

load();


/* ================= SHOW QUESTION ================= */

function showQuestion(){

const q=unitData.questions[questionIndex];

if(!q){

finishUnit();
return;
}

const card=document.getElementById("questionCard");

let html=`<h3>${q.question}</h3>`;

if(q.image){
html+=`<img src="${q.image}">`;
}

if(q.type==="meerkeuze"){

html+=`<div class="answers">`;

q.answers.forEach(ans=>{
if(ans){
html+=`<button onclick="checkAnswer('${ans}')">${ans}</button>`;
}
});

html+=`</div>`;

}

else if(q.type==="ja"){

html+=`
<div class="answers">
<button onclick="checkAnswer('ja')">Ja</button>
<button onclick="checkAnswer('nee')">Nee</button>
</div>
`;

}

else{

html+=`
<textarea id="inputAnswer" style="width:100%;height:100px"></textarea>
<button onclick="checkAnswer(document.getElementById('inputAnswer').value)">
Controleer
</button>
`;

}

card.innerHTML=html;

}


/* ================= CHECK ================= */

function checkAnswer(answer){

const q=unitData.questions[questionIndex];

let correct=false;

if(answer.toLowerCase().trim() ===
(q.correct||"").toLowerCase().trim()){
correct=true;
}

if(correct){

totalXP+=q.xp || 0;

document.getElementById("xpBox").innerText=
totalXP+" XP";

alert("Correct! +" + q.xp + " XP");

}else{

alert("Niet juist");
}

questionIndex++;
showQuestion();

}


/* ================= FINISH ================= */

function finishUnit(){

const nav=document.getElementById("navButtons");
const hasNextUnit=Boolean(themeData?.units?.[unitIndex+1]);

nav.innerHTML=`

<div class="card">

<h2>Klaar!</h2>
<p>Je behaalde ${totalXP} XP</p>

<button onclick="goTheme()">Terug naar thema</button>
${hasNextUnit ? '<button onclick="goNext()">Volgend doel</button>' : ''}

</div>
`;

document.getElementById("questionCard").innerHTML="";

}


function goTheme(){
window.history.back();
}

function goNext(){
window.location.href=
"unit.html?theme="+themeId+"&unit="+(unitIndex+1);
}

</script>

</body>
</html>
